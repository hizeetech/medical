<div class="d-flex justify-content-between align-items-center mb-2">
  <h2 class="h5 mb-0">Visit Details & Consultation Notes</h2>
  <span class="badge text-bg-secondary">Doctors & Nurses can add</span>
</div>
<div class="row g-3">
  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-body">
        {% if visits %}
          <div class="list-group">
            {% for v in visits %}
              <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="fw-semibold">{{ v.date_of_visit|date:'M d, Y H:i' }}</div>
                  <div class="small text-muted">{{ v.provider.full_name|default:v.provider.email }}</div>
                </div>
                <div class="mt-2">
                  <div><span class="text-muted small">Complaints</span><div>{{ v.complaints|linebreaks }}</div></div>
                  {% if v.examination_findings %}<div class="mt-2"><span class="text-muted small">Examination</span><div>{{ v.examination_findings|linebreaks }}</div></div>{% endif %}
                  {% if v.diagnosis %}<div class="mt-2"><span class="text-muted small">Diagnosis</span><div>{{ v.diagnosis|linebreaks }}</div></div>{% endif %}
                  {% if v.recommended_tests %}<div class="mt-2"><span class="text-muted small">Recommended Tests</span><div>{{ v.recommended_tests|linebreaks }}</div></div>{% endif %}
                  {% if v.treatment_plan %}<div class="mt-2"><span class="text-muted small">Treatment Plan</span><div>{{ v.treatment_plan|linebreaks }}</div></div>{% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="p-3 text-muted">No visit notes yet.</div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    {% if user.role == 'DOCTOR' or user.role == 'NURSE' %}
    <div class="card shadow-sm">
      <div class="card-body">
        <form hx-post="{% url 'casefile_visit_new' case_file.id %}" hx-target="#tab-content" hx-swap="innerHTML">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="d-grid mt-2">
            <button class="btn btn-primary" type="submit"><i class="bi bi-plus-circle"></i> Add Visit Record</button>
          </div>
        </form>
      </div>
    </div>
    {% endif %}
  </div>
</div>