{% load static %}
<div class="row g-3">
  <div class="col-lg-7">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h2 class="h5 mb-0">Medical History</h2>
      <span class="badge text-bg-secondary">Doctors & Nurses can edit</span>
    </div>
    <div class="card shadow-sm">
      <div class="card-body">
        {% if records %}
          <div class="list-group">
            {% for r in records %}
              <div class="list-group-item">
                <div class="fw-semibold">{{ r.title|default:'Record' }}</div>
                <div class="small text-muted">By {{ r.doctor.full_name|default:r.doctor.email }} Â· {{ r.created_at|date:'M d, Y H:i' }}</div>
                <div class="mt-2">{{ r.notes|linebreaks }}</div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="p-3 text-muted">No medical history on file.</div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    {% if user.role == 'DOCTOR' or user.role == 'NURSE' %}
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-title">Add Medical History Entry</h6>
        <form hx-post="{% url 'casefile_medical_history_new' case_file.id %}" hx-target="#tab-content" hx-swap="innerHTML">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="d-grid mt-2">
            <button class="btn btn-primary" type="submit"><i class="bi bi-plus-circle"></i> Add History Entry</button>
          </div>
        </form>
      </div>
    </div>
    {% endif %}
  </div>
</div>